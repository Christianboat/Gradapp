{% extends "base.html" %}

{% block title %}Add Application - AppTrack Pro{% endblock %}

{% block content %}
<div class="row justify-content-center animate-fade-in">
    <div class="col-lg-8">
        <div class="glass-card p-4 p-md-5">
            <div class="d-flex align-items-center mb-5 pb-3 border-bottom border-light">
                <div class="avatar-circle bg-primary-light text-primary rounded-circle p-3 me-3">
                    <i class="fas fa-plus fa-lg"></i>
                </div>
                <div>
                    <h2 class="h4 fw-bold mb-0">Add New Application</h2>
                    <p class="text-muted mb-0 small">Track a new opportunity</p>
                </div>
            </div>

            <form method="POST" action="{{ url_for('applications.create') }}">
                {{ form.hidden_tag() }}

                <div class="row g-4">
                    <!-- Left Column -->
                    <div class="col-md-6">
                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Application Title <span
                                    class="text-danger">*</span></label>
                            {{ form.title(class="form-control form-control-lg", placeholder="e.g. Senior Backend
                            Engineer") }}
                            {% if form.title.errors %}
                            <div class="text-danger small mt-1">{{ form.title.errors[0] }}</div>
                            {% endif %}
                        </div>

                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Type <span
                                    class="text-danger">*</span></label>
                            {{ form.application_type(class="form-select") }}
                        </div>

                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Institution / Company
                                <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0"><i
                                        class="fas fa-building text-muted"></i></span>
                                {{ form.institution(class="form-control border-start-0 ps-0", placeholder="e.g. Google")
                                }}
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Program / Role</label>
                            {{ form.program_role(class="form-control", placeholder="Optional role details") }}
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="col-md-6">
                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Deadline <span
                                    class="text-danger">*</span></label>
                            {{ form.deadline(class="form-control form-control-lg", type="date") }}
                            {% if form.deadline.errors %}
                            <div class="text-danger small mt-1">{{ form.deadline.errors[0] }}</div>
                            {% endif %}

                            <!-- Quick Date Buttons -->
                            <div class="mt-2 text-end">
                                <small class="text-muted me-2">Quick Set:</small>
                                <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" class="btn btn-outline-secondary deadline-btn"
                                        data-days="7">1W</button>
                                    <button type="button" class="btn btn-outline-secondary deadline-btn"
                                        data-days="14">2W</button>
                                    <button type="button" class="btn btn-outline-secondary deadline-btn"
                                        data-days="30">1M</button>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Status</label>
                            {{ form.status(class="form-select") }}
                        </div>

                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Country</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0"><i
                                        class="fas fa-globe-americas text-muted"></i></span>
                                {{ form.country(class="form-select border-start-0 ps-0") }}
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Portal URL</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0"><i
                                        class="fas fa-link text-muted"></i></span>
                                {{ form.application_url(class="form-control border-start-0 ps-0",
                                placeholder="https://...") }}
                            </div>
                        </div>
                    </div>

                    <!-- Full Width Notes -->
                    <div class="col-12">
                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Notes</label>
                            {{ form.notes(class="form-control", rows=4, placeholder="Requirements, login credentials,
                            thoughts...") }}
                        </div>
                    </div>
                </div>

                <div class="d-flex justify-content-end align-items-center mt-4 pt-3 border-top border-light gap-3">
                    <a href="{{ url_for('applications.list') }}"
                        class="btn btn-link text-muted text-decoration-none">Cancel</a>
                    <button type="submit" name="action" value="save_and_add" class="btn btn-outline-primary">Save & Add
                        Another</button>
                    <button type="submit" name="action" value="save" class="btn btn-primary px-4">Create
                        Application</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Quick deadline buttons
        const deadlineInput = document.querySelector('input[type="date"]');
        const deadlineBtns = document.querySelectorAll('.deadline-btn');

        deadlineBtns.forEach(btn => {
            btn.addEventListener('click', function () {
                const days = parseInt(this.dataset.days);
                const today = new Date();
                const futureDate = new Date(today);
                futureDate.setDate(today.getDate() + days);
                const formattedDate = futureDate.toISOString().split('T')[0];
                deadlineInput.value = formattedDate;
            });
        });

        // Set default date if needed (optional, handled by backend usually)
    });
</script>
{% endblock %}