{% extends "base.html" %}

{% block title %}Edit Application - AppTrack Pro{% endblock %}

{% block content %}
<div class="row justify-content-center animate-fade-in">
    <div class="col-lg-8">
        <div class="glass-card p-4 p-md-5">
            <div class="d-flex align-items-center mb-5 pb-3 border-bottom border-light">
                <div class="avatar-circle bg-warning-subtle text-warning rounded-circle p-3 me-3">
                    <i class="fas fa-edit fa-lg"></i>
                </div>
                <div>
                    <h2 class="h4 fw-bold mb-0">Edit Application</h2>
                    <p class="text-muted mb-0 small">{{ application.title }}</p>
                </div>
                <div class="ms-auto">
                    <form method="POST" action="{{ url_for('applications.delete', id=application.id) }}"
                        onsubmit="return confirm('Delete this application?');">
                        <button type="submit" class="btn btn-outline-danger btn-sm rounded-pill px-3">
                            <i class="fas fa-trash me-1"></i>Delete
                        </button>
                    </form>
                </div>
            </div>

            <form method="POST" action="{{ url_for('applications.edit', id=application.id) }}">
                {{ form.hidden_tag() }}

                <div class="row g-4">
                    <!-- Left Column -->
                    <div class="col-md-6">
                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Application Title <span
                                    class="text-danger">*</span></label>
                            {{ form.title(class="form-control form-control-lg") }}
                            {% if form.title.errors %}
                            <div class="text-danger small mt-1">{{ form.title.errors[0] }}</div>
                            {% endif %}
                        </div>

                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Type <span
                                    class="text-danger">*</span></label>
                            {{ form.application_type(class="form-select") }}
                        </div>

                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Institution / Company
                                <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0"><i
                                        class="fas fa-building text-muted"></i></span>
                                {{ form.institution(class="form-control border-start-0 ps-0") }}
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Program / Role</label>
                            {{ form.program_role(class="form-control") }}
                        </div>
                    </div>

                    <!-- Right Column -->
                    <div class="col-md-6">
                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Deadline <span
                                    class="text-danger">*</span></label>
                            {{ form.deadline(class="form-control form-control-lg", type="date") }}
                            {% if form.deadline.errors %}
                            <div class="text-danger small mt-1">{{ form.deadline.errors[0] }}</div>
                            {% endif %}

                            <!-- Detailed Deadline Status -->
                            {% set days = application.days_remaining() %}
                            <div class="mt-2">
                                {% if days is not none %}
                                {% if days < 0 %} <span
                                    class="badge bg-danger-subtle text-danger border border-danger-subtle">Overdue by {{
                                    -days }} days</span>
                                    {% elif days == 0 %}
                                    <span class="badge bg-warning-subtle text-warning border border-warning-subtle">Due
                                        Today!</span>
                                    {% else %}
                                    <span class="badge bg-success-subtle text-success border border-success-subtle">{{
                                        days }} days left</span>
                                    {% endif %}
                                    {% endif %}
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Status</label>
                            {{ form.status(class="form-select") }}
                        </div>

                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Country</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0"><i
                                        class="fas fa-globe-americas text-muted"></i></span>
                                {{ form.country(class="form-select border-start-0 ps-0") }}
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Portal URL</label>
                            <div class="input-group">
                                <span class="input-group-text bg-light border-0"><i
                                        class="fas fa-link text-muted"></i></span>
                                {{ form.application_url(class="form-control border-start-0 ps-0") }}
                            </div>
                        </div>
                    </div>

                    <!-- Full Width Notes -->
                    <div class="col-12">
                        <div class="mb-4">
                            <label class="form-label small text-uppercase text-muted fw-bold">Notes</label>
                            {{ form.notes(class="form-control", rows=5) }}
                        </div>
                    </div>
                </div>

                <!-- Timestamps -->
                <div class="row text-center my-4">
                    <div class="col-6">
                        <small class="text-muted d-block text-uppercase fw-bold"
                            style="font-size: 0.65rem;">Created</small>
                        <small class="text-dark">{{ format_date(application.created_at) }}</small>
                    </div>
                    <div class="col-6">
                        <small class="text-muted d-block text-uppercase fw-bold"
                            style="font-size: 0.65rem;">Updated</small>
                        <small class="text-dark">{{ format_date(application.updated_at) }}</small>
                    </div>
                </div>

                <div class="d-flex justify-content-end align-items-center mt-4 pt-3 border-top border-light gap-3">
                    <a href="{{ url_for('applications.view', id=application.id) }}"
                        class="btn btn-link text-muted text-decoration-none">Cancel</a>
                    <button type="submit" class="btn btn-primary px-4">Update Application</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}